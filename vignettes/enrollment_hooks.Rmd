---
title: "15 Insights from Tennessee School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Tennessee School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 8,
  fig.height = 5,
  warning = FALSE,
  message = FALSE,
  eval = TRUE,
  cache = TRUE
)
```

```{r load-packages}
library(tnschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)
theme_set(theme_minimal(base_size = 14))
```

## 1. Tennessee has nearly 1 million public school students

The Volunteer State serves a massive public school population, just shy of the million mark.

```{r statewide-data}
enr_2024 <- fetch_enr(2024, use_cache = TRUE)

statewide <- enr_2024 %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  select(end_year, n_students)

stopifnot(nrow(statewide) > 0)
statewide
```

```{r statewide-chart}
statewide %>% print()
ggplot(statewide, aes(x = factor(end_year), y = n_students / 1e6)) +
  geom_col(fill = "#FF6600", width = 0.6) +
  geom_text(aes(label = scales::comma(n_students)), vjust = -0.5, size = 4) +
  scale_y_continuous(
    labels = scales::label_number(suffix = "M"),
    limits = c(0, 1.2)
  ) +
  labs(
    title = "Tennessee Public School Enrollment (2024)",
    subtitle = "Nearly 1 million students in K-12 public schools",
    x = "School Year",
    y = "Total Students"
  )
```

## 2. Memphis-Shelby County Schools dwarfs all other districts

Memphis's merged district has more students than Nashville and Knoxville combined.

```{r top-districts-data}
top_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  arrange(desc(n_students)) %>%
  head(10) %>%
  select(district_name, n_students)

stopifnot(nrow(top_districts) == 10)
top_districts
```

```{r top-districts-chart}
top_districts %>% print()
top_districts %>%
  mutate(district_name = reorder(district_name, n_students)) %>%
  ggplot(aes(x = n_students / 1000, y = district_name)) +
  geom_col(fill = "#FF6600") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Top 10 Tennessee School Districts by Enrollment (2024)",
    subtitle = "Memphis-Shelby County Schools: Tennessee's largest district by far",
    x = "Students (thousands)",
    y = NULL
  )
```

## 3. Tennessee is 58% White, 24% Black, 15% Hispanic

The state's student demographics show a substantial minority population.

```{r demographics-data}
demographics <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian")) %>%
  select(subgroup, n_students) %>%
  mutate(
    subgroup = factor(subgroup,
      levels = c("white", "black", "hispanic", "asian"),
      labels = c("White", "Black", "Hispanic", "Asian")),
    pct = n_students / sum(n_students) * 100
  )

stopifnot(nrow(demographics) == 4)
demographics
```

```{r demographics-chart}
demographics %>% print()
ggplot(demographics, aes(x = n_students / 1000, y = reorder(subgroup, n_students))) +
  geom_col(fill = "#4292C6") +
  geom_text(aes(label = paste0(scales::comma(n_students), " (", round(pct, 1), "%)")),
            hjust = -0.05, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.25))
  ) +
  labs(
    title = "Student Demographics in Tennessee (2024)",
    subtitle = "Race/ethnicity breakdown of public school enrollment",
    x = "Students (thousands)",
    y = NULL
  )
```

## 4. Nashville metro anchors Middle Tennessee education

Nashville and its suburban ring serve over 200,000 students.

```{r regional-data}
middle_tn <- c("Metro Nashville", "Williamson", "Rutherford", "Wilson", "Sumner")
memphis_area <- c("Memphis-Shelby")
east_tn <- c("Knox", "Hamilton", "Blount")

regional <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  mutate(region = case_when(
    grepl(paste(middle_tn, collapse = "|"), district_name) ~ "Middle TN (Nashville Metro)",
    grepl(paste(memphis_area, collapse = "|"), district_name) ~ "Memphis Area",
    grepl(paste(east_tn, collapse = "|"), district_name) ~ "East TN (Knoxville/Chattanooga)",
    TRUE ~ "Other Districts"
  )) %>%
  group_by(region) %>%
  summarize(total = sum(n_students, na.rm = TRUE), .groups = "drop") %>%
  mutate(pct = total / sum(total) * 100)

stopifnot(nrow(regional) > 0)
regional
```

```{r regional-chart}
regional %>% print()
ggplot(regional, aes(x = total / 1000, y = reorder(region, total))) +
  geom_col(aes(fill = region), show.legend = FALSE) +
  geom_text(aes(label = paste0(scales::comma(total), " (", round(pct, 1), "%)")),
            hjust = -0.05, size = 3.5) +
  scale_fill_manual(values = c(
    "Middle TN (Nashville Metro)" = "#41AB5D",
    "Memphis Area" = "#EF6548",
    "East TN (Knoxville/Chattanooga)" = "#4292C6",
    "Other Districts" = "#807DBA"
  )) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.25))
  ) +
  labs(
    title = "Enrollment by Tennessee Region (2024)",
    subtitle = "Nashville metro and suburbs anchor Middle Tennessee",
    x = "Students (thousands)",
    y = NULL
  )
```

## 5. Rutherford County leads Tennessee's suburban boom

Murfreesboro's district has surpassed Hamilton County as the state's third-largest.

```{r growth-districts}
suburban_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  filter(grepl("Williamson|Rutherford|Wilson|Sumner|Montgomery|Hamilton", district_name)) %>%
  select(district_name, n_students) %>%
  arrange(desc(n_students))

stopifnot(nrow(suburban_districts) > 0)
suburban_districts
```

```{r growth-chart}
suburban_districts %>% print()
suburban_districts %>%
  mutate(district_name = reorder(district_name, n_students)) %>%
  ggplot(aes(x = n_students / 1000, y = district_name)) +
  geom_col(fill = "#41AB5D") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Growing Suburban Districts in Tennessee (2024)",
    subtitle = "Nashville and Chattanooga suburbs lead growth",
    x = "Students (thousands)",
    y = NULL
  )
```

## 6. Nashville is 29% English Learners -- highest in the state

Metro Nashville Public Schools has nearly 3x the state average English Learner rate.

```{r el-data}
el_data <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "lep") %>%
  select(n_students)

total_students <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
  pull(n_students)

stopifnot(nrow(el_data) > 0, total_students > 0)

el_pct <- el_data$n_students / total_students * 100

cat("English Learners:", scales::comma(el_data$n_students),
    "(", round(el_pct, 1), "% of total enrollment)\n")
```

```{r el-chart}
el_by_district <- enr_2024 %>%
  filter(is_district, grade_level == "TOTAL", subgroup == "lep") %>%
  left_join(
    enr_2024 %>%
      filter(is_district, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
      select(district_id, total = n_students),
    by = "district_id"
  ) %>%
  mutate(pct = n_students / total * 100) %>%
  filter(total > 10000) %>%
  arrange(desc(pct)) %>%
  head(10) %>%
  select(district_name, n_students, pct)

stopifnot(nrow(el_by_district) > 0)
el_by_district %>% print()

ggplot(el_by_district, aes(x = pct, y = reorder(district_name, pct))) +
  geom_col(fill = "#41AB5D") +
  geom_text(aes(label = paste0(round(pct, 1), "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_percent(scale = 1),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Districts with Highest English Learner Populations",
    subtitle = "Percent of students classified as English Learners (districts >10K students)",
    x = "English Learners (%)",
    y = NULL
  )
```

## 7. Memphis-Shelby has 53% economically disadvantaged students

The poverty gap between districts is stark -- Memphis-Shelby's rate is more than double Williamson County's.

```{r poverty-gap-data}
econ_by_district <- enr_2024 %>%
  filter(is_district, grade_level == "TOTAL", subgroup == "econ_disadv") %>%
  left_join(
    enr_2024 %>%
      filter(is_district, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
      select(district_id, total = n_students),
    by = "district_id"
  ) %>%
  mutate(pct = n_students / total * 100) %>%
  filter(total > 10000) %>%
  arrange(desc(pct)) %>%
  head(10) %>%
  select(district_name, n_students, total, pct)

stopifnot(nrow(econ_by_district) > 0)
econ_by_district
```

```{r poverty-gap-chart}
econ_by_district %>% print()
ggplot(econ_by_district, aes(x = pct, y = reorder(district_name, pct))) +
  geom_col(fill = "#EF6548") +
  geom_text(aes(label = paste0(round(pct, 1), "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_percent(scale = 1),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Economically Disadvantaged Students by District (2024)",
    subtitle = "Percent economically disadvantaged (districts >10K students)",
    x = "Economically Disadvantaged (%)",
    y = NULL
  )
```

## 8. Tennessee has over 1,800 school campuses

The state operates a vast network of schools, from tiny rural campuses to suburban mega-schools.

```{r campus-data}
campus_count <- enr_2024 %>%
  filter(is_campus, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  nrow()

top_campuses <- enr_2024 %>%
  filter(is_campus, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  arrange(desc(n_students)) %>%
  head(10) %>%
  select(campus_name, district_name, n_students)

stopifnot(campus_count > 0, nrow(top_campuses) == 10)

cat("Total school campuses:", campus_count, "\n")
top_campuses
```

```{r campus-chart}
top_campuses %>% print()
top_campuses %>%
  mutate(label = paste0(campus_name, "\n(", district_name, ")")) %>%
  mutate(label = reorder(label, n_students)) %>%
  ggplot(aes(x = n_students, y = label)) +
  geom_col(fill = "#4292C6") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Tennessee's Largest School Campuses (2024)",
    subtitle = paste0(scales::comma(campus_count), " total campuses statewide"),
    x = "Total Students",
    y = NULL
  )
```

## 9. 15% of Tennessee students receive special education services

Over 145,000 students receive special education services statewide.

```{r sped-data}
sped_data <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "special_ed") %>%
  select(n_students)

stopifnot(nrow(sped_data) > 0)

sped_pct <- sped_data$n_students / total_students * 100

cat("Special Education:", scales::comma(sped_data$n_students),
    "(", round(sped_pct, 1), "% of total enrollment)\n")
```

```{r sped-chart}
sped_by_district <- enr_2024 %>%
  filter(is_district, grade_level == "TOTAL", subgroup == "special_ed") %>%
  left_join(
    enr_2024 %>%
      filter(is_district, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
      select(district_id, total = n_students),
    by = "district_id"
  ) %>%
  mutate(pct = n_students / total * 100) %>%
  filter(total > 10000) %>%
  arrange(desc(pct)) %>%
  head(10) %>%
  select(district_name, n_students, pct)

stopifnot(nrow(sped_by_district) > 0)
sped_by_district %>% print()

ggplot(sped_by_district, aes(x = pct, y = reorder(district_name, pct))) +
  geom_col(fill = "#807DBA") +
  geom_text(aes(label = paste0(round(pct, 1), "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_percent(scale = 1),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Districts with Highest Special Education Rates",
    subtitle = "Percent of students receiving special education services (districts >10K students)",
    x = "Special Education (%)",
    y = NULL
  )
```

## 10. Nearly 1 in 3 Tennessee students is economically disadvantaged

About 29% of all students statewide qualify as economically disadvantaged.

```{r econ-data}
econ_data <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "econ_disadv") %>%
  select(n_students)

stopifnot(nrow(econ_data) > 0)

econ_pct <- econ_data$n_students / total_students * 100

cat("Economically Disadvantaged:", scales::comma(econ_data$n_students),
    "(", round(econ_pct, 1), "% of total enrollment)\n")
```

```{r econ-chart}
econ_comparison <- data.frame(
  category = c("Economically Disadvantaged", "Not Economically Disadvantaged"),
  n_students = c(econ_data$n_students, total_students - econ_data$n_students)
) %>%
  mutate(pct = n_students / sum(n_students) * 100)

econ_comparison %>% print()

ggplot(econ_comparison, aes(x = "", y = n_students, fill = category)) +
  geom_col(width = 1) +
  coord_polar(theta = "y") +
  geom_text(
    aes(label = paste0(round(pct, 1), "%")),
    position = position_stack(vjust = 0.5),
    color = "white",
    size = 6
  ) +
  scale_fill_manual(values = c(
    "Economically Disadvantaged" = "#EF6548",
    "Not Economically Disadvantaged" = "#41AB5D"
  )) +
  labs(
    title = "Economic Status of Tennessee Public School Students (2024)",
    subtitle = "About 29% of students qualify as economically disadvantaged",
    fill = NULL
  ) +
  theme_void() +
  theme(legend.position = "bottom")
```

## 11. Nashville is a majority-minority district -- the state is not

Metro Nashville Public Schools is 38% Black, 34% Hispanic, and 24% White -- a dramatic contrast with the 58% White statewide average.

```{r nashville-diversity-data}
nashville <- enr_2024 %>%
  filter(is_district, grade_level == "TOTAL",
         grepl("Metro Nashville", district_name),
         subgroup %in% c("white", "black", "hispanic", "asian")) %>%
  select(subgroup, n_students) %>%
  mutate(pct = n_students / sum(n_students) * 100,
         area = "Metro Nashville")

stopifnot(nrow(nashville) == 4)

state_demo <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian")) %>%
  select(subgroup, n_students) %>%
  mutate(pct = n_students / sum(n_students) * 100,
         area = "Tennessee State")

comparison <- bind_rows(nashville, state_demo)
comparison
```

```{r nashville-diversity-chart}
comparison %>% print()
ggplot(comparison, aes(x = pct, y = subgroup, fill = area)) +
  geom_col(position = "dodge", width = 0.7) +
  geom_text(aes(label = paste0(round(pct, 1), "%")),
            position = position_dodge(width = 0.7),
            hjust = -0.1, size = 3) +
  scale_fill_manual(values = c("Metro Nashville" = "#41AB5D", "Tennessee State" = "#4292C6")) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.2))) +
  labs(
    title = "Metro Nashville vs Tennessee Demographics (2024)",
    subtitle = "Nashville is majority-minority; the state is 58% White",
    x = "Percent of Students",
    y = NULL,
    fill = NULL
  ) +
  theme(legend.position = "bottom")
```

## 12. Knox County is East Tennessee's education hub

Knoxville's district accounts for 37% of all students in the region's major districts.

```{r knox-data}
knox <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Knox", district_name)) %>%
  select(district_name, n_students)

stopifnot(nrow(knox) > 0)
knox

east_tn_total <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Knox|Hamilton|Blount|Anderson|Sevier|Washington|Sullivan|Bradley", district_name)) %>%
  summarize(total = sum(n_students, na.rm = TRUE))

cat("Knox County share of major East TN districts:",
    round(knox$n_students / east_tn_total$total * 100, 1), "%\n")
```

```{r knox-chart}
east_tn_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Knox|Hamilton|Blount|Anderson|Sevier|Washington|Sullivan|Bradley", district_name)) %>%
  select(district_name, n_students) %>%
  arrange(desc(n_students))

stopifnot(nrow(east_tn_districts) > 0)
east_tn_districts %>% print()

ggplot(east_tn_districts, aes(x = n_students / 1000, y = reorder(district_name, n_students))) +
  geom_col(fill = "#4292C6") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "East Tennessee Major Districts (2024)",
    subtitle = "Knox County dominates the region with 37% of students",
    x = "Students (thousands)",
    y = NULL
  )
```

## 13. Tennessee has 147 school districts with a huge size gap

The median district has just 2,961 students -- less than half the 6,610 average -- showing extreme concentration.

```{r district-count-data}
district_count <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  summarize(
    n_districts = n(),
    total_students = sum(n_students, na.rm = TRUE),
    avg_size = mean(n_students, na.rm = TRUE),
    median_size = median(n_students, na.rm = TRUE)
  )

stopifnot(district_count$n_districts > 0)
district_count

cat("Average district size:", scales::comma(round(district_count$avg_size)), "students\n")
cat("Median district size:", scales::comma(round(district_count$median_size)), "students\n")
```

```{r district-size-distribution-chart}
district_sizes <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  mutate(size_category = case_when(
    n_students < 1000 ~ "Small (<1K)",
    n_students < 5000 ~ "Medium (1-5K)",
    n_students < 10000 ~ "Large (5-10K)",
    n_students < 25000 ~ "Very Large (10-25K)",
    TRUE ~ "Mega (25K+)"
  )) %>%
  count(size_category) %>%
  mutate(size_category = factor(size_category, levels = c("Small (<1K)", "Medium (1-5K)",
                                                          "Large (5-10K)", "Very Large (10-25K)",
                                                          "Mega (25K+)")))

stopifnot(nrow(district_sizes) > 0)
district_sizes %>% print()

ggplot(district_sizes, aes(x = n, y = size_category)) +
  geom_col(fill = "#807DBA") +
  geom_text(aes(label = n), hjust = -0.2, size = 4) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Distribution of Tennessee District Sizes (2024)",
    subtitle = "Most districts are small to medium-sized",
    x = "Number of Districts",
    y = NULL
  )
```

## 14. Tennessee runs an Achievement School District and a state charter commission

Tennessee's ASD and Public Charter School Commission together serve over 9,000 students as state-run alternatives to traditional districts.

```{r asd-data}
special_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Achievement School District|Charter School Commission", district_name)) %>%
  select(district_name, n_students)

stopifnot(nrow(special_districts) > 0)
special_districts

cat("Combined ASD + Charter Commission enrollment:",
    sum(special_districts$n_students), "students\n")
cat("Share of state total:",
    round(sum(special_districts$n_students) / total_students * 100, 2), "%\n")
```

```{r asd-chart}
# Compare ASD and Charter Commission to small/mid traditional districts
comparison_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Achievement|Charter School Commission|Putnam|Madison|Maury|Robertson|Bradley", district_name)) %>%
  select(district_name, n_students) %>%
  arrange(desc(n_students))

stopifnot(nrow(comparison_districts) > 0)
comparison_districts %>% print()

ggplot(comparison_districts, aes(x = n_students / 1000, y = reorder(district_name, n_students))) +
  geom_col(aes(fill = grepl("Achievement|Charter", district_name)), show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_fill_manual(values = c("TRUE" = "#EF6548", "FALSE" = "#4292C6")) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "State-Run vs Traditional Districts (2024)",
    subtitle = "Achievement School District and Charter Commission (red) vs traditional districts",
    x = "Students (thousands)",
    y = NULL
  )
```

## 15. Tennessee's smallest districts serve fewer than 200 students

The state's tiniest districts include specialized schools and rural communities.

```{r rural-challenges-data}
small_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         n_students < 2000) %>%
  arrange(n_students) %>%
  head(10) %>%
  select(district_name, n_students)

stopifnot(nrow(small_districts) > 0)
small_districts

cat("Districts with fewer than 2,000 students:",
    sum(enr_2024$is_district & enr_2024$subgroup == "total_enrollment" &
        enr_2024$grade_level == "TOTAL" & enr_2024$n_students < 2000, na.rm = TRUE), "\n")
```

```{r rural-challenges-chart}
small_districts %>% print()
ggplot(small_districts, aes(x = n_students, y = reorder(district_name, n_students))) +
  geom_col(fill = "#EF6548") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.2))) +
  labs(
    title = "Tennessee's Smallest School Districts (2024)",
    subtitle = "Includes specialized state schools and rural communities",
    x = "Total Students",
    y = NULL
  )
```

## Explore the data yourself

```r
library(tnschooldata)

# Fetch 2024 data
enr <- fetch_enr(2024, use_cache = TRUE)

# State totals
enr %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL")

# Your district
enr %>%
  filter(grepl("Knox", district_name),
         subgroup == "total_enrollment",
         grade_level == "TOTAL")
```

See the [quickstart guide](quickstart.html) for more examples.

## Session Info

```{r session-info}
sessionInfo()
```

---
title: "10 Insights from Tennessee School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{10 Insights from Tennessee School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 8,
  fig.height = 5,
  warning = FALSE,
  message = FALSE,
  eval = TRUE,
  cache = TRUE
)
```

```{r load-packages}
library(tnschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)
theme_set(theme_minimal(base_size = 14))
```

## 1. Tennessee has nearly 1 million public school students

The Volunteer State serves a massive public school population.

```{r statewide-data}
enr_2024 <- fetch_enr(2024, use_cache = TRUE)

statewide <- enr_2024 %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  select(end_year, n_students)

statewide
```

```{r statewide-chart}
ggplot(statewide, aes(x = factor(end_year), y = n_students / 1e6)) +
  geom_col(fill = "#FF6600", width = 0.6) +
  geom_text(aes(label = scales::comma(n_students)), vjust = -0.5, size = 4) +
  scale_y_continuous(
    labels = scales::label_number(suffix = "M"),
    limits = c(0, 1.2)
  ) +
  labs(
    title = "Tennessee Public School Enrollment (2024)",
    subtitle = "Nearly 1 million students in K-12 public schools",
    x = "School Year",
    y = "Total Students"
  )
```

## 2. Shelby County dwarfs all other districts

Memphis's district has more students than the next three combined.

```{r top-districts-data}
top_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  arrange(desc(n_students)) %>%
  head(10) %>%
  select(district_name, n_students)

top_districts
```

```{r top-districts-chart}
top_districts %>%
  mutate(district_name = reorder(district_name, n_students)) %>%
  ggplot(aes(x = n_students / 1000, y = district_name)) +
  geom_col(fill = "#FF6600") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Top 10 Tennessee School Districts by Enrollment (2024)",
    subtitle = "Shelby County: Tennessee's largest district by far",
    x = "Students (thousands)",
    y = NULL
  )
```

## 3. Tennessee's diversity is growing

The state's student population reflects changing demographics.

```{r demographics-data}
demographics <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian")) %>%
  select(subgroup, n_students) %>%
  mutate(
    subgroup = factor(subgroup,
      levels = c("white", "black", "hispanic", "asian"),
      labels = c("White", "Black", "Hispanic", "Asian")),
    pct = n_students / sum(n_students) * 100
  )

demographics
```

```{r demographics-chart}
ggplot(demographics, aes(x = n_students / 1000, y = reorder(subgroup, n_students))) +
  geom_col(fill = "#4292C6") +
  geom_text(aes(label = paste0(scales::comma(n_students), " (", round(pct, 1), "%)")),
            hjust = -0.05, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.25))
  ) +
  labs(
    title = "Student Demographics in Tennessee (2024)",
    subtitle = "Race/ethnicity breakdown of public school enrollment",
    x = "Students (thousands)",
    y = NULL
  )
```

## 4. Middle Tennessee leads in enrollment

Nashville and its suburbs are education powerhouses.

```{r regional-data}
middle_tn <- c("Davidson", "Williamson", "Rutherford", "Wilson", "Sumner")
memphis_area <- c("Shelby")
east_tn <- c("Knox", "Hamilton", "Blount")

regional <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  mutate(region = case_when(
    grepl(paste(middle_tn, collapse = "|"), district_name) ~ "Middle TN (Nashville Metro)",
    grepl(paste(memphis_area, collapse = "|"), district_name) ~ "Memphis Area",
    grepl(paste(east_tn, collapse = "|"), district_name) ~ "East TN (Knoxville/Chattanooga)",
    TRUE ~ "Other Districts"
  )) %>%
  group_by(region) %>%
  summarize(total = sum(n_students, na.rm = TRUE), .groups = "drop") %>%
  mutate(pct = total / sum(total) * 100)

regional
```

```{r regional-chart}
ggplot(regional, aes(x = total / 1000, y = reorder(region, total))) +
  geom_col(aes(fill = region), show.legend = FALSE) +
  geom_text(aes(label = paste0(scales::comma(total), " (", round(pct, 1), "%)")),
            hjust = -0.05, size = 3.5) +
  scale_fill_manual(values = c(
    "Middle TN (Nashville Metro)" = "#41AB5D",
    "Memphis Area" = "#EF6548",
    "East TN (Knoxville/Chattanooga)" = "#4292C6",
    "Other Districts" = "#807DBA"
  )) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.25))
  ) +
  labs(
    title = "Enrollment by Tennessee Region (2024)",
    subtitle = "Middle Tennessee leads with Nashville metro growth",
    x = "Students (thousands)",
    y = NULL
  )
```

## 5. Williamson County is Tennessee's fastest-growing affluent district

The Nashville suburb exemplifies suburban growth.

```{r growth-districts}
suburban_districts <- enr_2024 %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  filter(grepl("Williamson|Rutherford|Wilson|Sumner|Montgomery|Hamilton", district_name)) %>%
  select(district_name, n_students) %>%
  arrange(desc(n_students))

suburban_districts
```

```{r growth-chart}
suburban_districts %>%
  mutate(district_name = reorder(district_name, n_students)) %>%
  ggplot(aes(x = n_students / 1000, y = district_name)) +
  geom_col(fill = "#41AB5D") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Growing Suburban Districts in Tennessee (2024)",
    subtitle = "Nashville and Chattanooga suburbs lead growth",
    x = "Students (thousands)",
    y = NULL
  )
```

## 6. English Learners are transforming Tennessee classrooms

A multilingual future is already here.

```{r el-data}
el_data <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "lep") %>%
  select(n_students)

total_students <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
  pull(n_students)

el_pct <- el_data$n_students / total_students * 100

cat("English Learners:", scales::comma(el_data$n_students),
    "(", round(el_pct, 1), "% of total enrollment)\n")
```

```{r el-chart}
el_by_district <- enr_2024 %>%
  filter(is_district, grade_level == "TOTAL", subgroup == "lep") %>%
  left_join(
    enr_2024 %>%
      filter(is_district, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
      select(district_id, total = n_students),
    by = "district_id"
  ) %>%
  mutate(pct = n_students / total * 100) %>%
  filter(total > 10000) %>%  # Only larger districts
  arrange(desc(pct)) %>%
  head(10) %>%
  select(district_name, n_students, pct)

ggplot(el_by_district, aes(x = pct, y = reorder(district_name, pct))) +
  geom_col(fill = "#41AB5D") +
  geom_text(aes(label = paste0(round(pct, 1), "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_percent(scale = 1),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Districts with Highest English Learner Populations",
    subtitle = "Percent of students classified as English Learners (districts >10K students)",
    x = "English Learners (%)",
    y = NULL
  )
```

## 7. Gender balance remains steady across Tennessee schools

Boys slightly outnumber girls in public schools.

```{r gender-data}
gender <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("male", "female")) %>%
  select(subgroup, n_students) %>%
  mutate(pct = n_students / sum(n_students) * 100)

gender
```

```{r gender-chart}
ggplot(gender, aes(x = "", y = n_students, fill = subgroup)) +
  geom_col(width = 1) +
  coord_polar(theta = "y") +
  geom_text(
    aes(label = paste0(subgroup, "\n", round(pct, 1), "%")),
    position = position_stack(vjust = 0.5),
    color = "white",
    size = 5
  ) +
  scale_fill_manual(
    values = c("male" = "#4292C6", "female" = "#DE77AE"),
    labels = c("male" = "Male", "female" = "Female")
  ) +
  labs(
    title = "Gender Distribution in Tennessee Public Schools (2024)",
    subtitle = "Boys slightly outnumber girls statewide"
  ) +
  theme_void() +
  theme(legend.position = "none")
```

## 8. High school enrollment is substantial

Secondary schools serve nearly 300,000 students.

```{r grade-level-data}
grade_data <- enr_2024 %>%
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("K8", "HS")) %>%
  select(grade_level, n_students) %>%
  mutate(grade_level = factor(grade_level,
    levels = c("K8", "HS"),
    labels = c("K-8", "High School (9-12)")))

grade_data
```

```{r grade-level-chart}
ggplot(grade_data, aes(x = n_students / 1000, y = grade_level)) +
  geom_col(aes(fill = grade_level), show.legend = FALSE, width = 0.6) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 4) +
  scale_fill_manual(values = c("K-8" = "#4292C6", "High School (9-12)" = "#807DBA")) +
  scale_x_continuous(
    labels = scales::label_number(suffix = "K"),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "K-8 vs High School Enrollment in Tennessee (2024)",
    subtitle = "Elementary and middle schools serve more students than high schools",
    x = "Students (thousands)",
    y = NULL
  )
```

## 9. Special education serves a significant population

More students receiving specialized services.

```{r sped-data}
sped_data <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "special_ed") %>%
  select(n_students)

sped_pct <- sped_data$n_students / total_students * 100

cat("Special Education:", scales::comma(sped_data$n_students),
    "(", round(sped_pct, 1), "% of total enrollment)\n")
```

```{r sped-chart}
sped_by_district <- enr_2024 %>%
  filter(is_district, grade_level == "TOTAL", subgroup == "special_ed") %>%
  left_join(
    enr_2024 %>%
      filter(is_district, grade_level == "TOTAL", subgroup == "total_enrollment") %>%
      select(district_id, total = n_students),
    by = "district_id"
  ) %>%
  mutate(pct = n_students / total * 100) %>%
  filter(total > 10000) %>%
  arrange(desc(pct)) %>%
  head(10) %>%
  select(district_name, n_students, pct)

ggplot(sped_by_district, aes(x = pct, y = reorder(district_name, pct))) +
  geom_col(fill = "#807DBA") +
  geom_text(aes(label = paste0(round(pct, 1), "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(
    labels = scales::label_percent(scale = 1),
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Districts with Highest Special Education Rates",
    subtitle = "Percent of students receiving special education services (districts >10K students)",
    x = "Special Education (%)",
    y = NULL
  )
```

## 10. Economically disadvantaged students are the majority

Over half of Tennessee students qualify for free/reduced lunch.

```{r econ-data}
econ_data <- enr_2024 %>%
  filter(is_state, grade_level == "TOTAL", subgroup == "econ_disadv") %>%
  select(n_students)

econ_pct <- econ_data$n_students / total_students * 100

cat("Economically Disadvantaged:", scales::comma(econ_data$n_students),
    "(", round(econ_pct, 1), "% of total enrollment)\n")
```

```{r econ-chart}
econ_comparison <- data.frame(
  category = c("Economically Disadvantaged", "Not Economically Disadvantaged"),
  n_students = c(econ_data$n_students, total_students - econ_data$n_students)
) %>%
  mutate(pct = n_students / sum(n_students) * 100)

ggplot(econ_comparison, aes(x = "", y = n_students, fill = category)) +
  geom_col(width = 1) +
  coord_polar(theta = "y") +
  geom_text(
    aes(label = paste0(round(pct, 1), "%")),
    position = position_stack(vjust = 0.5),
    color = "white",
    size = 6
  ) +
  scale_fill_manual(values = c(
    "Economically Disadvantaged" = "#EF6548",
    "Not Economically Disadvantaged" = "#41AB5D"
  )) +
  labs(
    title = "Economic Status of Tennessee Public School Students (2024)",
    subtitle = "Majority of students qualify for free/reduced price meals",
    fill = NULL
  ) +
  theme_void() +
  theme(legend.position = "bottom")
```

## Explore the data yourself

```r
library(tnschooldata)

# Fetch 2024 data
enr <- fetch_enr(2024, use_cache = TRUE)

# State totals
enr %>%
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL")

# Your district
enr %>%
  filter(grepl("Knox", district_name),
         subgroup == "total_enrollment",
         grade_level == "TOTAL")
```

See the [quickstart guide](quickstart.html) for more examples.

## Session Info

```{r session-info}
sessionInfo()
```
